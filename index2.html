<html>
	<head>
		<title>number two</title>
		<style>
			body {
				font-family:arial;
			}
			ul {
				list-style-type:none;
				padding-left:0px;
			}

			li {
				padding:0px;
				position:relative;
			}

			h3 {
				padding:0px 0px 0px 5px;
				margin:0px;
			}

			#top {
				padding:0px;
			}
			#top>.list {
				display:inline-block;
				vertical-align:top;
				width:250px;
				margin:2px;
				padding:0px;
			}

			.list {
				border:solid;
				border-width:5px;
				margin:1px;
			}

			.list>h3{
				background-color:black;
				color:white;
				padding:0px;
			}
			.list>.toolbar{
				color:white;
			}

			.list.selected>h3,.list.selected>.toolbar {
				border-color:#000000;
				background-color:#000000;
			}

			.selected>h3,.selected>.toolbar {
				background-color:#555555;
				color:white;
			}

			.toolbar{
				color:white;
				font-weight:700;

				position:static;
				right:5px;
				top:0;

				text-align:justify;

				cursor:default;
			}
			.list>.toolbar {
				position:absolute;
				right:5px;
				top:0;

				padding:0px;
			}

			.mouseOver {
				color:orange;
			}

			.checked>h3 {
				color:#6495ED;
			}

			.toolbar>.minClicked {
				color:orange;
			}
			.list > h3.minClicked {
				color:orange;
			}
			.checked.list > h3.minClicked {
				color:#6495ED;
			}
		</style>

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
		<script>
			var id_counter;

			function init() {
				var list;

				id_counter = 0;

				list = loadList();
				if(list) {
					parseList( loadList() );
				}
				$("#top").mousedown( topClickHandler );
			}

			function addList( listName, destination, checked ) {
				var newList,		// The list we'll be creating
					newItem;		// The item that the list will reside in

				newList = $( document.createElement("ul") );

				// Let addItem take care of the list node
				newItem = addItem( listName, destination, true, checked );
				newItem = $( newItem );
				newItem.addClass("list");

				// Add the new list to the new list node
				newItem.append( newList );

				// Update localStorage
				saveList( scanList() );

				// Return the list element and remove the jQuery stuff.
				return newList[ 0 ];
			}

			function addItem( itemName, destination, skipUpdate, checked ) {
				var newItem,		// The new list node to be appended to destination
					itemHeader,		// The header node contained in the list
					destinationTag,
					toolbar;

				// Create the list item
				newItem = $( document.createElement("li") );
				newItem.mousedown( liClickHandler );

				// Create and attach a h3 to a new list node
				itemHeader = $( document.createElement("h3") );
				itemHeader.css( "padding-left", "25px" );

				// Create checkbox for completed items
				checkboxContainer = $( document.createElement("div") );
				checkboxContainer.click( checkboxClickHandler );

				checkboxContainer.css( "width", "25px" );
				checkboxContainer.css( "display", "inline-block" );
				checkboxContainer.css( "margin-left", "-25px" );
				checkboxContainer.css( "vertical-align", "top" );

				checkbox = $( document.createElement("input") );
				checkbox.attr( "type", "checkbox" );
				if( checked ) {
					checkbox.prop( "checked", true );
					newItem.addClass("checked");
				}

				checkboxContainer.append( checkbox );
				itemHeader.append( checkboxContainer );

				// Attach the text separately
				itemText = $( document.createElement("div") );
				itemText.addClass("itemText");
				itemText.css( "display", "inline-block" );
				itemText.css( "width", "100%" );
				itemText.css( "vertical-align", "middle" );
				itemText.html( itemName );
				itemHeader.append( itemText );

				// Append the header to the list item
				newItem.append( itemHeader );

				// Get proper destination.  If destination is not a list, insert after given dest.
				destinationTag = $( destination ).prop("tagName");
				if( destinationTag === "UL" ) {
					$( destination ).prepend( newItem );
				} else if( $(destination).children("ul").length ) {
					$( destination ).children("ul").prepend( newItem );
				} else if( $(destination).children.length ) {
					newItem.insertAfter( destination );
				} else {
					return 0;
				}

				// Attach toolbar after we're done building the item
				setTimeout( function() {
					toolbar = makeToolbar( newItem[0] );
					newItem.append( toolbar );

					if( !newItem.hasClass("list") ) {
						$( toolbar ).hide();
					}
				}, 0 );

				// Update localStorage
				if( !skipUpdate ) {
					saveList( scanList() );
				}

				// Return the list node without jQuery stuff
				return newItem[ 0 ];
			}

			function deleteItem( itemDOMNode ) {
				var oldNode;

				// Pull the node out of the DOM, and return it to the user.
				oldNode = $( itemDOMNode ).detach();

				// Update localStorage
				saveList( scanList() );

				return oldNode[ 0 ];
			}

			function scanList() {
				var parsedDOM,
					scanStack,
					domStack,
					curScan,
					curDOM,
					nextDOM,
					chilren,
					curChild,
					childTag,
					i;

				parsedDOM = {
					"lists" : []
				};

				scanStack = [];
				scanStack.push( parsedDOM.lists );

				domStack = [];
				domStack.push( $("#top") );

				while( domStack.length ) {
					curDOM = domStack.pop();
					curScan = scanStack.pop();
					children = curDOM.children("li");

					for( i=0; i<children.length; i++ ) {
						curChild = children[ i ];
						childTag = $( curChild ).prop( "tagName" );

						curScan[ i ] = {};
						curScan[ i ].header = $( curChild ).children("h3").children(".itemText").html();
						curScan[ i ].checked = $( curChild ).hasClass("checked");

						nextDOM = $( curChild ).children("ul");
						if( nextDOM[0] ) {
							curScan[ i ].list = [];

							domStack.push( nextDOM );
							scanStack.push( curScan[i].list );
						} else {
							curScan[ i ].list = null;
						}

					}
				}

				return parsedDOM;
			}

			function makeToolbar(item) {
				var close,
					min,
					add,
					toolbar,
					lineAfter,
					padding;

				toolbar = $( document.createElement("div") );
				toolbar.addClass("toolbar");

				close = $( document.createElement("span") );
				close.html(" X ");
				close.mousedown( closeClickHandler );
				close.hover( function() {
					$( this ).toggleClass("mouseOver");
				} );
				toolbar.prepend( close );

				if( $(item).hasClass("list") ) {
					min = $( document.createElement("span") );
					min.html(" _ ");
					min.mousedown( minClickHandler );
					min.hover( function() {
						$( this ).toggleClass("mouseOver");
					} );
					toolbar.prepend( min );
				}

				send = $( document.createElement("span") );
				send.html(" > ");
				send.mousedown( sendClickHandler );
				send.hover( function() {
					$( this ).toggleClass("mouseOver");
				} );
				toolbar.prepend( send );

				add = $( document.createElement("span") );
				add.html(" + ");
				add.mousedown( addClickHandler );
				add.hover( function() {
					$( this ).toggleClass("mouseOver");
				} );
				toolbar.prepend( add );

				padding = $( document.createElement("div") );
				padding.css( "display", "inline-block" );
				toolbar.prepend( padding );

				padding = $( document.createElement("div") );
				padding.css( "display", "inline-block" );
				toolbar.append( padding );

				lineAfter = $( document.createElement("div") );
				lineAfter.html("");
				lineAfter.css( "display", "inline-block" );
				lineAfter.css( "width", "100%" );
				toolbar.append( lineAfter );

				return toolbar[ 0 ];
			}

			function parseList(list) {
				var domFinal,
					scanStack,
					domStack,
					curScan,
					curDOM,
					nextDOM,
					nextChild,
					curHeading,
					i;

				domFinal = $( document.createElement("ul") );

				scanStack = [];
				scanStack.push( list.lists );

				domStack = [];
				domStack.push( $("#top") );

				while( scanStack.length ) {
					curDOM = domStack.pop();
					curScan = scanStack.pop();

					for( i=curScan.length-1; i>=0; i-- ) {
						if( curScan[i].list ) {
							nextDOM = addList( curScan[i].header, curDOM, curScan[i].checked );

							domStack.push( nextDOM );
							scanStack.push( curScan[i].list );
						} else {
							addItem( curScan[i].header, curDOM, false, curScan[i].checked );
						}
					}
				}
			}

			function saveList(list) {
				localStorage.list = JSON.stringify( list );
			}

			function loadList() {
				if( localStorage.list ) {
					return JSON.parse( localStorage.list );
				}

				return 0;
			}


			function liClickHandler(e) {
				var selected,
					deselected;

				selected = $( e.currentTarget );

				deselected = $(".selected");
				deselected.removeClass("selected");

				selected.addClass("selected");
				selected.children(".toolbar").slideDown(200);

				deselected = deselected.filter(":not(.selected):not(.list)");
				deselected.children(".toolbar").slideUp(200);

				e.stopPropagation();
			}

			function topClickHandler(e){
				var selected;

				selected = $(".selected")

				selected.removeClass("selected");

				selected = selected.filter(":not(.selected):not(.list)");

				selected.children(".toolbar").slideUp(200);

				$("li").unbind( "mousedown", sendClickHandler );
			}

			function closeClickHandler(e) {
				var itemDOMNode;

				itemDOMNode = $( e.currentTarget ).parent().parent()[ 0 ];
				$( itemDOMNode ).slideUp( 200, function() {
					deleteItem( itemDOMNode );
				} );
			}

			function addClickHandler(e) {
				var itemDOMNode,
					text,
					newItem;

				itemDOMNode = $( e.currentTarget ).parent().parent()[ 0 ];

				text = $("#myTextbox").val();

				newItem = addItem( text, itemDOMNode );
				$( newItem ).hide();
				$( newItem ).slideDown( 200 );
			}

			function sendClickHandler(e) {
				var toSend;

				toSend = $( e.currentTarget ).parent().parent();
				toSend.addClass("toSend");

				$("li").mousedown( sendeeClickHandler );

				e.stopPropagation();
			}

			function sendeeClickHandler(e) {
				var toSend,
					destination;

				$("li").unbind( "mousedown", sendClickHandler );

				destination = $( e.currentTarget );

				if( destination.hasClass("toSend") ) {
					destination.removeClass("toSend");
					return 0;
				}

				toSend = $(".toSend");
				toSend.removeClass("toSend");

				toSend.slideUp( 200, function() {
					deleteItem( toSend );
					if( destination.hasClass("list") ) {
						destination.children("ul").prepend( toSend );
					} else {
						toSend.insertAfter( destination );
					}
					toSend.slideDown( 200 );

					e.stopPropagation();
				} );
			}

			function checkboxClickHandler(e) {
				var boxContainer,
					listItem;

				boxContainer = $( e.currentTarget );
				listItem = boxContainer.parent().parent();

				listItem.toggleClass("checked");

				saveList( scanList() );
			}

			function minClickHandler(e) {
				var itemDOMNode,
					minButton,
					header;

				itemDOMNode = $( e.currentTarget ).parent().parent().children("ul");
				minButton = $( e.currentTarget );
				header = minButton.parent().parent().children("h3");

				itemDOMNode.slideToggle( 200 );

				header.toggleClass("minClicked");
				minButton.toggleClass("minClicked");
			}

			function addListButtonHandler(e) {
				var title,
					destination,
					selected;

				title = $("#myTextbox").val();
				selected = $(".selected");

				if( selected.length ) {
					destination = $(".selected")[ 0 ];
				} else {
					destination = $("#top")[ 0 ]
				}

				addList( title, destination );
			}

			function addItemButtonHandler(e) {
				var title,
					destination;

				title = $("#myTextbox").val();

				destination = $(".selected")[0];

				addItem( title, destination );
			}

			function deleteItemHeaderHandler(e) {
				var itemDOMNode;

				itemDOMNode = $( e.target ).parent()[ 0 ];
				deleteItem( itemDOMNode );
			}

			function completedRemoveButtonHandler(e) {
				var completed;

				completed = $(".checked");

				completed.slideUp( 200, function() {
					completed.detach();
					saveList( scanList() );
				} );
			}
		</script>
	</head>
	<body>
		<div id="testing">
			<button id="itemAdd">add item</button>
			<button id="listAdd">add list</button>
			<button id="completedRemove">clear completed</button>
			<form action="javascript:addItemButtonHandler()">
				<input type="text" id="myTextbox" />
			</form>
		</div>
		<ul id="top"></ul>

		<script>
			$(document).ready( function() {
				init();
				$("#itemAdd").click( addItemButtonHandler );
				$("#listAdd").click( addListButtonHandler );
				$("#completedRemove").click( completedRemoveButtonHandler );
			});
		</script>
	</body>
</html>
